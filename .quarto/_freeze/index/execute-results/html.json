{
  "hash": "f600d4cd3037b4b9c1cb7da712427ba9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle-block-banner: '#54698a' \ntitle-block-banner-color : '#dee1e3'\ntitle: \"Dwuczynnikowa Anova - przykład\"\nauthor: \"Michał Kołodziejczyk\"\ndate: \"2024-12-13\"\nformat: \n  html:\n    toc: true\n #   number-sections: true\n    tbl-pos: 'H'\ncss: styles.css\neditor: visual\n---\n\n\n# Problem do rozwiązania\n\nWykonano po 5 pomiarów średnic drobnego elementu produkowanego na 5 różnych maszynach przy zastosowaniu dwu różnych chłodziw A i B. Należy sprawdzić, czy rodzaj chłodziwa ma jakikolwiek wpływ na średnicę wytwarzanych elementów.\n\nCzynnikami wyróżniającymi są numer maszyny i rodzaj chłodziwa. Do analizy problemu wykorzystano dwuczynnikową analizę wariancji, która bada wpływ dwóch różnych jakościowych zmiennych niezależnych (jeden - maszyna, drugi - chłodziwo) na jedną ciągłą zmienną zależną (średnica elementu). Przykład i dane liczbowe zostały wzięte z poradnika: <https://www.itl.nist.gov/div898/handbook/ppc/section2/ppc232.htm>.\n\nDane liczbowe zostały przedstawione w tabeli na rysunku poniżej.\n\n![Pomiary średnicy $d$ elementu w zależności od maszyny i chłodziwa.](2czynniki.png){fig-align=\"center\" width=\"447\"}\n\nUkład zerowych hipotez, które będą testowane metodą Anova:\n\n-   $H0_1$: *Czynnik 1 nie wpływa na zmienną zależną.*\n\n-   $𝐻0_2$: *Czynnik 2 nie wpływa na zmienną zależną.*\n\n-   $𝐻0_{1-2}$: *Wzajemna interakcja czynników 1 i 2 nie wpływa na zmienną zależną.*\n\nAnalizę Anova i czynności przygotowawcze wykonano w R (RStudio). Analizę post-hoc porównania parami - w Pythonie.\n\n# Wczytanie i analiza danych\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaneA <- read.table(\"ChłodziwoA.txt\", header=T)\ndaneB <- read.table(\"ChłodziwoB.txt\", header=T)\n```\n:::\n\n::: {#tbl-1 .cell tbl-cap='Pomiary średnicy $d$ dla chłodziwa A'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:right;\"> Maszyna1 </th>\n   <th style=\"text-align:right;\"> Maszyna2 </th>\n   <th style=\"text-align:right;\"> Maszyna3 </th>\n   <th style=\"text-align:right;\"> Maszyna4 </th>\n   <th style=\"text-align:right;\"> Maszyna5 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.118 </td>\n   <td style=\"text-align:right;\"> 0.123 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.118 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n   <td style=\"text-align:right;\"> 0.122 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.120 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n   <td style=\"text-align:right;\"> 0.120 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 0.119 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 0.121 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {#tbl-2 .cell tbl-cap='Pomiary średnicy $d$ dla chłodziwa B'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:right;\"> Maszyna1 </th>\n   <th style=\"text-align:right;\"> Maszyna2 </th>\n   <th style=\"text-align:right;\"> Maszyna3 </th>\n   <th style=\"text-align:right;\"> Maszyna4 </th>\n   <th style=\"text-align:right;\"> Maszyna5 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.116 </td>\n   <td style=\"text-align:right;\"> 0.122 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.121 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 0.123 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n   <td style=\"text-align:right;\"> 0.119 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.114 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.130 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 0.120 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.117 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Przygotowanie danych do analizy wariancji\n\nZapis danych w postaci 'data frame', której pierwszą kolumną są średnice, a wyróżnik maszyny to druga kolumna, trzecia kolumna to rodzaj chłodziwa.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- dim(daneA)[1]       # liczba pomiarów, tzw 'powtórzeń' \nm <- dim(daneA)[2]       # liczba maszyn (kolumn )\nk <- 2                   # liczba poziomów czynnika 1 (rodzaju chłodziwa)\n\nnag <- colnames(daneA)   # nagłówki kolumn\nsrednice <- data.frame(data = NA, nrow = 2*n*m,ncol =3)  # deklaracja \nfor(j in seq(1,m,1)){\n    for (i in seq(1,n,1)){\n      srednice[i+(j-1)*n,1] <- daneA[i,j]\n      srednice[i+(j-1)*n,2] <- nag[j]\n      srednice[i+(j-1)*n,3] <- \"A\"\n    }\n}\n\nfor(j in seq(1,m,1)){\n    for (i in seq(1,n,1)){\n      srednice[n*m+i+(j-1)*n,1] <- daneB[i,j]\n      srednice[n*m+i+(j-1)*n,2] <- nag[j]\n      srednice[n*m+i+(j-1)*n,3] <- \"B\"\n    }\n}\n\n# zamiana typu kolumn\nsrednice[,2] <- as.factor(srednice[,2])\nsrednice[,3] <- as.factor(srednice[,3])\n\n# wprowadzenie nazw kolumn\ncolnames(srednice)= c(\"d\",\"Maszyna\", \"Chłodziwo\")\nhead(srednice)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      d  Maszyna Chłodziwo\n1 0.125 Maszyna1         A\n2 0.127 Maszyna1         A\n3 0.125 Maszyna1         A\n4 0.126 Maszyna1         A\n5 0.128 Maszyna1         A\n6 0.118 Maszyna2         A\n```\n\n\n:::\n:::\n\n\n## Wykres pudełkowy\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(ggplot2)\nggplot(srednice, aes(x = Maszyna, y = d,  fill = Chłodziwo) ) +\ngeom_boxplot()\n```\n\n::: {.cell-output-display}\n![Wykres pudełkowy zależności $d$ od numeru maszyny i chłodziwa](index_files/figure-html/fig-2-1.png){#fig-2 width=672}\n:::\n:::\n\n\n# Analiza Anova\n\nAnalizę Anova z uwzględnieniem interakcji pomiędzy czynnikami przeprowadzono w R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanowa <- aov(formula = d ~ Maszyna*Chłodziwo, data = srednice)\nsummary(anowa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  Df    Sum Sq   Mean Sq F value   Pr(>F)    \nMaszyna            4 0.0003033 7.583e-05   8.766 3.52e-05 ***\nChłodziwo          1 0.0000039 3.920e-06   0.453    0.505    \nMaszyna:Chłodziwo  4 0.0000147 3.670e-06   0.424    0.790    \nResiduals         40 0.0003460 8.650e-06                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n## Wynik analizy\n\nAnova wykazała, że czynnikiem wpływającym na wynik (średnicę $d$) w sposób istotny statystycznie jest Maszyna. Wynika to z wartości prawdopodobieństwa p \\< 0.05 tylko dla czynnika Maszyna. Rodzaj chłodziwa nie ma wpływu (p \\>0.05), jak również interakcje.\n\nOznacza to, że przynajmniej jedna z maszyn produkuje elementy różniące się od innych w sposób istotny statystycznie. W celu sprawdzenia, które maszyny produkują elementy różniące się istotnie od innych, należy wykonać analizę porównania parami metodą Tukeya HSD. Analiza została przeprowadzona z wykorzystaniem Pythona.\n\n# Analiza post-hoc porównania parami\n\nPorównanie parami przeprowadzono metodą Tukeya HSD w Pythonie wykorzystując obiekt R (data frame 'srednice').\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# python -m pip install statsmodels\nimport pandas as pd\nimport numpy as np\nimport statsmodels\nfrom scipy.stats import f_oneway\nfrom statsmodels.stats.multicomp import pairwise_tukeyhsd\n\n# Badanie wpływu czynnika Maszyna\n# r.srednice - odwołanie z poziomu Pythona do obiektu R\ntuk1 = pairwise_tukeyhsd(endog=r.srednice['d'],\n                          groups=r.srednice['Maszyna'],\n                          alpha=0.05)\nprint(tuk1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Multiple Comparison of Means - Tukey HSD, FWER=0.05   \n========================================================\n group1   group2  meandiff p-adj   lower   upper  reject\n--------------------------------------------------------\nMaszyna1 Maszyna2  -0.0057 0.0005 -0.0093 -0.0021   True\nMaszyna1 Maszyna3  -0.0024 0.3398  -0.006  0.0012  False\nMaszyna1 Maszyna4   0.0005 0.9948 -0.0031  0.0041  False\nMaszyna1 Maszyna5  -0.0047 0.0052 -0.0083 -0.0011   True\nMaszyna2 Maszyna3   0.0033 0.0889 -0.0003  0.0069  False\nMaszyna2 Maszyna4   0.0062 0.0001  0.0026  0.0098   True\nMaszyna2 Maszyna5    0.001 0.9335 -0.0026  0.0046  False\nMaszyna3 Maszyna4   0.0029  0.171 -0.0007  0.0065  False\nMaszyna3 Maszyna5  -0.0023 0.3824 -0.0059  0.0013  False\nMaszyna4 Maszyna5  -0.0052 0.0016 -0.0088 -0.0016   True\n--------------------------------------------------------\n```\n\n\n:::\n\n```{.python .cell-code}\n# Badanie wpływu czynnika Chłodziwo\ntuk2 = pairwise_tukeyhsd(endog=r.srednice['d'],\n                          groups=r.srednice['Chłodziwo'],\n                          alpha=0.05)\nprint(tuk2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMultiple Comparison of Means - Tukey HSD, FWER=0.05\n==================================================\ngroup1 group2 meandiff p-adj  lower  upper  reject\n--------------------------------------------------\n     A      B  -0.0006 0.597 -0.0027 0.0016  False\n--------------------------------------------------\n```\n\n\n:::\n:::\n\n\n# Analiza wpływu maszyny\n\nWynik porównania dla czynnika Chłodziwo oznacza, że nie ma ono istotnego statystycznie wpływu na średnicę elemenu (p \\> 0.05). Wyniki porównania parami dla czynnika Maszyna przeanalizowano w R, wykorzystując uzyskany wcześniej obiekt Pythona (pairwise_tukeyhsd).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  kombinacja <- function(dane){      \n# definicja funkcji wykonującej kombinację poziomów faktora \"dane\"\n#  i zapisującej je jako jednokolumnową data frame\n  \n  elementy <- levels(dane)           # poziomy faktora \"dane\"\n  kombinacje <- combn(elementy,2,paste, collapse = \"-\", simplify = TRUE)\n  kombinacje <- as.data.frame(kombinacje)\n  return(kombinacje)\n}\n# kombinacja(srednice$Maszyna)\n```\n:::\n\n\n## Maszyny różniące się w sposób statystycznie istotny\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(reticulate)                             # hub do Pythona\n\n# liczba możliwych kombinacji 2 różnych liczb spośród 5\nn <- factorial(5)/factorial(2)/factorial(3)     # factorial() - silnia\nkombi <- kombinacja(srednice$Maszyna)           # możliwe kombinacje maszyn\n\n# wyszukiwanie wyników porównania parami z prawdopodobieństwem p < 0.05\nwynik <- data.frame(NA) \npom <- rep(0,n)\np <- rep(0,n)\nj <- 0\nfor (i in 1:n){    \n  if ( py$tuk1$pvalues[i] < 0.05 ) {    # odwołanie z poziomu R do obiektu Pythona\n       j <- j+1\n       pom[j] <- i\n       p[j] <- py$tuk1$pvalues[i]     \n  }\n}\n\n# zapis wyników wyszukiwania\nfor (i in 1:j){\n  wynik[i,1] <- kombi[pom[i],1] \n  wynik[i,2] <- p[i] \n  wynik[i,3] <- \"istotna\"\n}\n\ncolnames(wynik) <- c(\"Porównanie parami\", \"p\", \"różnica\")\n```\n:::\n\n::: {#tbl-3 .cell tbl-cap='Maszyny różniące się w sposób istotny statystycznie' tbl-pos='H'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Porównanie parami </th>\n   <th style=\"text-align:left;\"> p </th>\n   <th style=\"text-align:left;\"> różnica </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna1-Maszyna2 </td>\n   <td style=\"text-align:left;\"> 0.0004717 </td>\n   <td style=\"text-align:left;\"> istotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna1-Maszyna5 </td>\n   <td style=\"text-align:left;\"> 0.0051667 </td>\n   <td style=\"text-align:left;\"> istotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna2-Maszyna4 </td>\n   <td style=\"text-align:left;\"> 0.0001330 </td>\n   <td style=\"text-align:left;\"> istotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna4-Maszyna5 </td>\n   <td style=\"text-align:left;\"> 0.0016046 </td>\n   <td style=\"text-align:left;\"> istotna </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Maszyny nie różniące się w sposób statystycznie istotny\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# wyszukiwanie wyników porównania parami z prawdopodobieństwem p > 0.05\nwynik <- data.frame(NA) \npom <- rep(0,n)\np <- rep(0,n)\nj <- 0\nfor (i in 1:n){    \n  if ( py$tuk1$pvalues[i] > 0.05 ) {    # odwołanie z poziomu R do obiektu Pythona\n       j <- j+1\n       pom[j] <- i\n       p[j] <- py$tuk1$pvalues[i]     \n  }\n}\n\n# zapis wyników wyszukiwania\nfor (i in 1:j){\n  wynik[i,1] <- kombi[pom[i],1] \n  wynik[i,2] <- p[i] \n  wynik[i,3] <- \"nieistotna\"\n}\n\ncolnames(wynik) <- c(\"Porównanie parami\", \"p\", \"różnica\")\n```\n:::\n\n::: {#tbl-4 .cell tbl-cap='Maszyny nie różniące się w sposób statystycznie istotny'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Porównanie parami </th>\n   <th style=\"text-align:left;\"> p </th>\n   <th style=\"text-align:left;\"> różnica </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna1-Maszyna3 </td>\n   <td style=\"text-align:left;\"> 0.3398099 </td>\n   <td style=\"text-align:left;\"> nieistotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna1-Maszyna4 </td>\n   <td style=\"text-align:left;\"> 0.9947892 </td>\n   <td style=\"text-align:left;\"> nieistotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna2-Maszyna3 </td>\n   <td style=\"text-align:left;\"> 0.0889036 </td>\n   <td style=\"text-align:left;\"> nieistotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna2-Maszyna5 </td>\n   <td style=\"text-align:left;\"> 0.9334903 </td>\n   <td style=\"text-align:left;\"> nieistotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna3-Maszyna4 </td>\n   <td style=\"text-align:left;\"> 0.1709501 </td>\n   <td style=\"text-align:left;\"> nieistotna </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Maszyna3-Maszyna5 </td>\n   <td style=\"text-align:left;\"> 0.3824476 </td>\n   <td style=\"text-align:left;\"> nieistotna </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n# Podsumowanie\n\nAnaliza ANOVA wykazała, że wpływ rodzaju chłodziwa na wynik w postaci średnicy elementu jest nieistotny statystycznie, natomiast występują różnice statystycznie istotne pomiędzy elementami wyprodukowanymi na różnych maszynach.\n\nWyniki zaprezentowane w ostatniej tabeli wskazują, że maszyny można podzielić na dwie zazębiające się grupy:\n\n-   Maszyna1 - Maszyna 3 - Maszyna 4\n\n-   Maszyna 2 - Maszyna 3 - Maszyna 5\n\nElementem wspólnym obu grup jest Maszyna 3. Jej produkty najmniej różnią się od pozostałych. Jednak występujące różnice pomiędzy grupami wymagają ustalenia ich przyczyny i wyeliminowania.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}