{
  "hash": "6222bc6f136b1104175962a2d635db64",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle-block-banner: '#54698a' \ntitle-block-banner-color : '#dee1e3'\ntitle: \"Two-way Anova - an example\"\nauthor: \"Micha≈Ç Ko≈Çodziejczyk\"\ndate: \"2024-12-22\"\nformat: \n  html:\n    toc: true\n #   number-sections: true\n    tbl-pos: 'H'\ncss: styles.css\neditor: visual\n---\n\n\n# Problem to be solved\n\n5 measurements have been made of the diameter of a small element produced on 5 different machines using two different coolants A and B were made. It should be checked whether the type of coolant has any effect on the diameter of the elements produced.\n\nThe distinguishing factors are the machine number and the type of coolant. The problem was analyzed using a two-way analysis of variance, which examines the effect of two different qualitative independent variables (one - machine, the other - coolant) on a continuous dependent variable (the diameter of the element). The example and the numerical data have been taken from the guide: <https://www.itl.nist.gov/div898/handbook/ppc/section2/ppc232.htm.>\n\nThe numerical data are presented in the table in the figure below.\n\n![Measurements of the diameter $d$ of the part as a function of the machine and the coolant.](2factors.png){fig-align=\"center\" width=\"486\"}\n\nThe null hypotheses to be tested using the Anova method:\n\n-   \\$H0_1\\$: Factor 1 (coolant) has no effect on the dependent variable.\n\n-   \\$ùêª0_2\\$: Factor 2 (Machine) has no effect on the dependent variable.\n\n-   \\$ùêª0\\_{1-2}\\$: The interaction of factors 1 and 2 has no effect on the dependent variable.\n\nAnova analysis and preparatory steps were performed in R (RStudio). Post-hoc analysis of pairwise comparisons was performed in Python.\n\n# Data Loading and Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaneA <- read.table(\"CoolantA.txt\", header=T)\ndaneB <- read.table(\"CoolantB.txt\", header=T)\n```\n:::\n\n::: {#tbl-1 .cell tbl-cap='Diameter measurements $d$ for coolant A'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:right;\"> Machine1 </th>\n   <th style=\"text-align:right;\"> Machine2 </th>\n   <th style=\"text-align:right;\"> Machine3 </th>\n   <th style=\"text-align:right;\"> Machine4 </th>\n   <th style=\"text-align:right;\"> Machine5 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.118 </td>\n   <td style=\"text-align:right;\"> 0.123 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.118 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n   <td style=\"text-align:right;\"> 0.122 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.120 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n   <td style=\"text-align:right;\"> 0.120 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 0.119 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 0.121 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {#tbl-2 .cell tbl-cap='Diameter measurements $d$ for coolant B'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:right;\"> Machine1 </th>\n   <th style=\"text-align:right;\"> Machine2 </th>\n   <th style=\"text-align:right;\"> Machine3 </th>\n   <th style=\"text-align:right;\"> Machine4 </th>\n   <th style=\"text-align:right;\"> Machine5 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.116 </td>\n   <td style=\"text-align:right;\"> 0.122 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 0.128 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.121 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 0.123 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> 0.127 </td>\n   <td style=\"text-align:right;\"> 0.119 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.114 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.126 </td>\n   <td style=\"text-align:right;\"> 0.130 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 0.120 </td>\n   <td style=\"text-align:right;\"> 0.125 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 0.117 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Data preparation for variance analysis\n\nThe data is recorded in the form of a 'data frame' where the first column is the diameter, the second column is the machine factor and the third column is the coolant type.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- dim(daneA)[1]       # number of measurements\nm <- dim(daneA)[2]       # number of machines\nk <- 2                   # number of levels of factor 1 (coolant)\n\nnag <- colnames(daneA)   \nsrednice <- data.frame(data = NA, nrow = 2*n*m,ncol =3)   \nfor(j in seq(1,m,1)){\n    for (i in seq(1,n,1)){\n      srednice[i+(j-1)*n,1] <- daneA[i,j]\n      srednice[i+(j-1)*n,2] <- nag[j]\n      srednice[i+(j-1)*n,3] <- \"A\"\n    }\n}\n\nfor(j in seq(1,m,1)){\n    for (i in seq(1,n,1)){\n      srednice[n*m+i+(j-1)*n,1] <- daneB[i,j]\n      srednice[n*m+i+(j-1)*n,2] <- nag[j]\n      srednice[n*m+i+(j-1)*n,3] <- \"B\"\n    }\n}\n\n# columns as factors\nsrednice[,2] <- as.factor(srednice[,2])\nsrednice[,3] <- as.factor(srednice[,3])\n\n# names of the columns\ncolnames(srednice)= c(\"d\",\"Machine\", \"Coolant\")\nhead(srednice)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      d  Machine Coolant\n1 0.125 Machine1       A\n2 0.127 Machine1       A\n3 0.125 Machine1       A\n4 0.126 Machine1       A\n5 0.128 Machine1       A\n6 0.118 Machine2       A\n```\n\n\n:::\n:::\n\n\n## Box plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(ggplot2)\nggplot(srednice, aes(x = Machine, y = d,  fill = Coolant) ) +\ngeom_boxplot()\n```\n\n::: {.cell-output-display}\n![Box plot of $d$ dependence on machine number and coolant](index_en_files/figure-html/fig-2-1.png){#fig-2 width=672}\n:::\n:::\n\n\n# Anova Analysis\n\nAnova analysis with interactions between factors was performed in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanowa <- aov(formula = d ~ Machine*Coolant, data = srednice)\nsummary(anowa)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                Df    Sum Sq   Mean Sq F value   Pr(>F)    \nMachine          4 0.0003033 7.583e-05   8.766 3.52e-05 ***\nCoolant          1 0.0000039 3.920e-06   0.453    0.505    \nMachine:Coolant  4 0.0000147 3.670e-06   0.424    0.790    \nResiduals       40 0.0003460 8.650e-06                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n## Results\n\nAnova showed that the factor that influenced the result (diameter \\$d\\$) in a statistically significant way was the Machine. This is shown by the probability value of p \\< 0.05 for the Machine factor only. The type of coolant has no influence (p \\>0.05), as do the interactions.This means that at least one of the machines produces parts that differ from the others in a statistically significant way.\n\nTo see which machines produce parts that are significantly different from the others, a pairwise comparison analysis should be performed using the Tukey HSD method. The analysis was performed using Python.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport statsmodels\nfrom scipy.stats import f_oneway\nfrom statsmodels.stats.multicomp import pairwise_tukeyhsd\n\n# Investigating the impact of the Machine factor\n# r.srednice - a Python-level reference to an R object\ntuk1 = pairwise_tukeyhsd(endog=r.srednice['d'],\n                          groups=r.srednice['Machine'],\n                          alpha=0.05)\nprint(tuk1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Multiple Comparison of Means - Tukey HSD, FWER=0.05   \n========================================================\n group1   group2  meandiff p-adj   lower   upper  reject\n--------------------------------------------------------\nMachine1 Machine2  -0.0057 0.0005 -0.0093 -0.0021   True\nMachine1 Machine3  -0.0024 0.3398  -0.006  0.0012  False\nMachine1 Machine4   0.0005 0.9948 -0.0031  0.0041  False\nMachine1 Machine5  -0.0047 0.0052 -0.0083 -0.0011   True\nMachine2 Machine3   0.0033 0.0889 -0.0003  0.0069  False\nMachine2 Machine4   0.0062 0.0001  0.0026  0.0098   True\nMachine2 Machine5    0.001 0.9335 -0.0026  0.0046  False\nMachine3 Machine4   0.0029  0.171 -0.0007  0.0065  False\nMachine3 Machine5  -0.0023 0.3824 -0.0059  0.0013  False\nMachine4 Machine5  -0.0052 0.0016 -0.0088 -0.0016   True\n--------------------------------------------------------\n```\n\n\n:::\n\n```{.python .cell-code}\n# Investigating the impact of the Coolant factor\ntuk2 = pairwise_tukeyhsd(endog=r.srednice['d'],\n                          groups=r.srednice['Coolant'],\n                          alpha=0.05)\nprint(tuk2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMultiple Comparison of Means - Tukey HSD, FWER=0.05\n==================================================\ngroup1 group2 meandiff p-adj  lower  upper  reject\n--------------------------------------------------\n     A      B  -0.0006 0.597 -0.0027 0.0016  False\n--------------------------------------------------\n```\n\n\n:::\n:::\n\n\n# Investigating the impact of the Machine factor\n\nThe pairwise comparison result for the Coolant factor means that it has no statistically significant effect on element diameter (p \\> 0.05). The pairwise comparison results for the Machine factor were analysed in R, using the Python object obtained earlier (pairwise_tukeyhsd).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  kombinacja <- function(dane){      \n# definition of a function which performs a combination of the levels of the ‚Äòdane‚Äô factor and saving it as a single-column data frame\n  \n  elementy <- levels(dane)           # levels of the factor \"dane\"\n  kombinacje <- combn(elementy,2,paste, collapse = \"-\", simplify = TRUE)\n  kombinacje <- as.data.frame(kombinacje)\n  return(kombinacje)\n}\n# kombinacja(srednice$Maszyna)\n```\n:::\n\n\n## Machines that differ in a statistically significant way\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(reticulate)                             # hub to Python\n\n# number of possible combinations of 2 different numbers out of 5\nn <- factorial(5)/factorial(2)/factorial(3)     \nkombi <- kombinacja(srednice$Machine)           # possible combinations of Machines\n\n# Search for results of pairwise comparisons with a probability of p < 0.05\nwynik <- data.frame(NA) \npom <- rep(0,n)\np <- rep(0,n)\nj <- 0\nfor (i in 1:n){    \n  if ( py$tuk1$pvalues[i] < 0.05 ) {    # R-level reference to a Python object\n       j <- j+1\n       pom[j] <- i\n       p[j] <- py$tuk1$pvalues[i]     \n  }\n}\n\n# search results\nfor (i in 1:j){\n  wynik[i,1] <- kombi[pom[i],1] \n  wynik[i,2] <- p[i] \n  wynik[i,3] <- \"significant\"  \n}\n\ncolnames(wynik) <- c(\"pairwise comparisons\", \"p\", \"difference\")\n```\n:::\n\n::: {#tbl-3 .cell tbl-cap='Machines that differ in a statistically significant way' tbl-pos='H'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> pairwise comparisons </th>\n   <th style=\"text-align:left;\"> p </th>\n   <th style=\"text-align:left;\"> difference </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Machine1-Machine2 </td>\n   <td style=\"text-align:left;\"> 0.0004717 </td>\n   <td style=\"text-align:left;\"> significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine1-Machine5 </td>\n   <td style=\"text-align:left;\"> 0.0051667 </td>\n   <td style=\"text-align:left;\"> significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine2-Machine4 </td>\n   <td style=\"text-align:left;\"> 0.0001330 </td>\n   <td style=\"text-align:left;\"> significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine4-Machine5 </td>\n   <td style=\"text-align:left;\"> 0.0016046 </td>\n   <td style=\"text-align:left;\"> significant </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Machines not statistically significantly different\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Search for results of pairwise comparisons with a probability of p > 0.05\nwynik <- data.frame(NA) \npom <- rep(0,n)\np <- rep(0,n)\nj <- 0\nfor (i in 1:n){    \n  if ( py$tuk1$pvalues[i] > 0.05 ) {    # R-level reference to a Python object\n       j <- j+1\n       pom[j] <- i\n       p[j] <- py$tuk1$pvalues[i]     \n  }\n}\n\n# search results\nfor (i in 1:j){\n  wynik[i,1] <- kombi[pom[i],1] \n  wynik[i,2] <- p[i] \n  wynik[i,3] <- \"not significant\" \n}\n\ncolnames(wynik) <- c(\"pairwise comparisons\", \"p\", \"difference\")\n```\n:::\n\n::: {#tbl-4 .cell tbl-cap='Machines not statistically significantly different'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> pairwise comparisons </th>\n   <th style=\"text-align:left;\"> p </th>\n   <th style=\"text-align:left;\"> difference </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Machine1-Machine3 </td>\n   <td style=\"text-align:left;\"> 0.3398099 </td>\n   <td style=\"text-align:left;\"> not significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine1-Machine4 </td>\n   <td style=\"text-align:left;\"> 0.9947892 </td>\n   <td style=\"text-align:left;\"> not significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine2-Machine3 </td>\n   <td style=\"text-align:left;\"> 0.0889036 </td>\n   <td style=\"text-align:left;\"> not significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine2-Machine5 </td>\n   <td style=\"text-align:left;\"> 0.9334903 </td>\n   <td style=\"text-align:left;\"> not significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine3-Machine4 </td>\n   <td style=\"text-align:left;\"> 0.1709501 </td>\n   <td style=\"text-align:left;\"> not significant </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Machine3-Machine5 </td>\n   <td style=\"text-align:left;\"> 0.3824476 </td>\n   <td style=\"text-align:left;\"> not significant </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n# Summary\n\nThe ANOVA analysis showed that the effect of the type of coolant on the result in terms of part diameter is not statistically significant, while there are statistically significant differences between parts produced on different machines.\n\nThe results presented in the last table indicate that the machines can be divided into two interrelated groups:\n\n-   Machine 1 - Machine 3 - Machine 4\n\n-   Machine 2 - Machine 3 - Machine 5\n\nThe common element of both groups is Machine 3. Its products are the least different from the others. However, the differences that exist between the groups must be identified and eliminated.\n",
    "supporting": [
      "index_en_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}